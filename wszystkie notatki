
===============================================================================================================TRANSAKCJE=============================================================================================


1. Co to jest transakcja w bazie danych?
Transakcja to zbiÃ³r operacji na bazie danych, ktÃ³re sÄ… wykonywane jako jedna, niepodzielna jednostka pracy.
Oznacza to, Å¼e albo wszystkie operacje w transakcji zostanÄ… wykonane (zatwierdzone), albo Å¼adna z nich (cofniÄ™cie zmian).

ğŸ”¹ PrzykÅ‚ad transakcji:
WyobraÅº sobie, Å¼e chcesz przelaÄ‡ pieniÄ…dze z konta A na konto B.
Wymaga to dwÃ³ch operacji:

OdjÄ™cie kwoty z konta A
Dodanie tej samej kwoty do konta B
Co siÄ™ stanie, jeÅ›li odejmiemy pieniÄ…dze z konta A, ale przed dodaniem ich do konta B nastÄ…pi awaria systemu?
Bez transakcji moglibyÅ›my utraciÄ‡ pieniÄ…dze, bo tylko pierwsza operacja zostaÅ‚aby wykonana.

WÅ‚aÅ›nie dlatego transakcja gwarantuje, Å¼e albo obie operacje siÄ™ wykonajÄ…, albo Å¼adna z nich!

2. Zasady transakcji â€“ ACID
KaÅ¼da transakcja powinna speÅ‚niaÄ‡ cztery podstawowe zasady ACID:

Zasada	Opis
A (Atomicity, NiepodzielnoÅ›Ä‡)	Transakcja jest niepodzielna â€“ albo wykonuje siÄ™ w caÅ‚oÅ›ci, albo nie wykonuje siÄ™ wcale.
C (Consistency, SpÃ³jnoÅ›Ä‡)	Po zakoÅ„czeniu transakcji baza danych musi pozostaÄ‡ w spÃ³jnym stanie (np. saldo konta siÄ™ zgadza).
I (Isolation, Izolacja)	RÃ³wnoczeÅ›nie dziaÅ‚ajÄ…ce transakcje nie powinny sobie przeszkadzaÄ‡.
D (Durability, TrwaÅ‚oÅ›Ä‡)	Po zatwierdzeniu (COMMIT) zmiany nie mogÄ… zostaÄ‡ utracone.
âœ… DziÄ™ki tym zasadom baza danych dziaÅ‚a poprawnie i bez bÅ‚Ä™dÃ³w!

3. Jak dziaÅ‚ajÄ… transakcje w SQL?
W SQL transakcje obsÅ‚ugujemy za pomocÄ… trzech podstawowych poleceÅ„:

1ï¸âƒ£ RozpoczÄ™cie transakcji

sql
Kopiuj
Edytuj
START TRANSACTION; -- Rozpoczynamy transakcjÄ™
2ï¸âƒ£ Wykonanie operacji

sql
Kopiuj
Edytuj
UPDATE konto SET saldo = saldo - 100 WHERE id = 1;  -- Odejmujemy 100 zÅ‚ z konta 1
UPDATE konto SET saldo = saldo + 100 WHERE id = 2;  -- Dodajemy 100 zÅ‚ do konta 2
3ï¸âƒ£ Zatwierdzenie zmian (COMMIT) lub ich anulowanie (ROLLBACK)

sql
Kopiuj
Edytuj
COMMIT;   -- Potwierdzamy transakcjÄ™, zapisujÄ…c zmiany
-- LUB
ROLLBACK; -- Cofamy transakcjÄ™, usuwajÄ…c wszystkie zmiany
ğŸŸ¢ JeÅ›li wszystko dziaÅ‚a dobrze â†’ COMMIT zapisuje zmiany w bazie.
ğŸ”´ JeÅ›li coÅ› poszÅ‚o nie tak â†’ ROLLBACK przywraca bazÄ™ do poprzedniego stanu.

4. Problemy przy rÃ³wnoczesnych transakcjach
Gdy wiele transakcji dziaÅ‚a w tym samym czasie, mogÄ… pojawiÄ‡ siÄ™ problemy, np.:

Problem	Opis
Dirty Read (brudny odczyt)	Transakcja A czyta dane, ktÃ³re transakcja B zmieniÅ‚a, ale nie zatwierdziÅ‚a (COMMIT). JeÅ›li transakcja B zrobi ROLLBACK, transakcja A bazuje na bÅ‚Ä™dnych danych.
Non-Repeatable Read (niepowtarzalny odczyt)	Transakcja A odczytuje te same dane dwa razy, ale transakcja B je zmienia miÄ™dzy odczytami.
Phantom Read (widmowy odczyt)	Transakcja A wykonuje zapytanie np. SELECT * FROM klienci WHERE wiek > 18, a transakcja B dodaje nowy rekord pasujÄ…cy do warunku â€“ A dostaje inny wynik niÅ¼ poprzednio.
5. Poziomy izolacji w SQL (jak transakcje wpÅ‚ywajÄ… na siebie nawzajem)
Poziomy izolacji okreÅ›lajÄ…, jak bardzo transakcje mogÄ… na siebie wpÅ‚ywaÄ‡.
Im wyÅ¼szy poziom izolacji, tym mniejsze ryzyko bÅ‚Ä™dÃ³w, ale wiÄ™kszy spadek wydajnoÅ›ci.

Poziom izolacji	Chroni przed:
READ UNCOMMITTED	âŒ Brak ochrony, moÅ¼e wystÄ…piÄ‡ Dirty Read
READ COMMITTED	âœ… Blokuje Dirty Read, ale moÅ¼e wystÄ…piÄ‡ Non-Repeatable Read
REPEATABLE READ	âœ… Blokuje Dirty Read i Non-Repeatable Read, ale moÅ¼e wystÄ…piÄ‡ Phantom Read
SERIALIZABLE	âœ… Blokuje wszystkie bÅ‚Ä™dy, ale jest najwolniejszy
6. PrzykÅ‚ady poziomÃ³w izolacji w SQL
KaÅ¼dy poziom izolacji moÅ¼emy ustawiÄ‡ w transakcji:

ğŸ”¹ READ COMMITTED (domyÅ›lny poziom w SQL Server i Oracle)

sql
Kopiuj
Edytuj
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
START TRANSACTION;
SELECT * FROM klienci;
COMMIT;
âœ… Blokuje brudne odczyty (Dirty Read).

ğŸ”¹ SERIALIZABLE (najbezpieczniejszy, ale najwolniejszy)

sql
Kopiuj
Edytuj
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
START TRANSACTION;
SELECT * FROM zamowienia WHERE status = 'oczekujÄ…ce';
COMMIT;
âœ… Gwarantuje maksymalnÄ… izolacjÄ™, ale moÅ¼e powodowaÄ‡ blokady.

7. Podsumowanie â€“ co warto zapamiÄ™taÄ‡?
âœ” Transakcja to seria operacji, ktÃ³re wykonujÄ… siÄ™ razem.
âœ” ACID zapewnia bezpieczeÅ„stwo i spÃ³jnoÅ›Ä‡ transakcji.
âœ” Poziomy izolacji okreÅ›lajÄ…, jak transakcje wpÅ‚ywajÄ… na siebie nawzajem.
âœ” Im wyÅ¼szy poziom izolacji, tym mniejsze ryzyko bÅ‚Ä™dÃ³w, ale wiÄ™kszy spadek wydajnoÅ›ci.

==================================================================================================FUNKCJE=======================================================================


OczywiÅ›cie! OmÃ³wiÄ™ funkcje w bazach danych, w szczegÃ³lnoÅ›ci w SQL, poniewaÅ¼ sÄ… one kluczowym elementem pracy z danymi.

1. Co to jest funkcja w SQL?
Funkcja to blok kodu, ktÃ³ry przyjmuje argumenty, wykonuje okreÅ›lone operacje i zwraca wynik.
DziÄ™ki funkcjom moÅ¼na manipulowaÄ‡ danymi, wykonywaÄ‡ obliczenia i automatyzowaÄ‡ operacje w bazie danych.

Rodzaje funkcji w SQL:
1ï¸âƒ£ Funkcje skalarne â€“ zwracajÄ… pojedynczÄ… wartoÅ›Ä‡
2ï¸âƒ£ Funkcje agregujÄ…ce â€“ operujÄ… na wielu wierszach i zwracajÄ… jednÄ… wartoÅ›Ä‡
3ï¸âƒ£ Funkcje uÅ¼ytkownika (UDF) â€“ tworzone przez programistÄ™

2. Funkcje skalarne (jednowierszowe)
ZwracajÄ… jednÄ… wartoÅ›Ä‡ na podstawie pojedynczego wiersza danych.

ğŸ“Œ PrzykÅ‚ady funkcji skalarnych:
âœ… Funkcje matematyczne
Funkcja	Opis	PrzykÅ‚ad
ABS(x)	WartoÅ›Ä‡ bezwzglÄ™dna	SELECT ABS(-5); â†’ 5
ROUND(x, d)	ZaokrÄ…glanie do d miejsc po przecinku	SELECT ROUND(3.1415, 2); â†’ 3.14
CEIL(x)	ZaokrÄ…glenie w gÃ³rÄ™	SELECT CEIL(2.3); â†’ 3
FLOOR(x)	ZaokrÄ…glenie w dÃ³Å‚	SELECT FLOOR(2.9); â†’ 2
âœ… Funkcje tekstowe
Funkcja	Opis	PrzykÅ‚ad
UPPER(str)	Zamienia na wielkie litery	SELECT UPPER('test'); â†’ TEST
LOWER(str)	Zamienia na maÅ‚e litery	SELECT LOWER('TeSt'); â†’ test
LENGTH(str)	DÅ‚ugoÅ›Ä‡ ciÄ…gu znakÃ³w	SELECT LENGTH('SQL'); â†’ 3
CONCAT(str1, str2)	ÅÄ…czenie tekstÃ³w	SELECT CONCAT('Hello', ' World'); â†’ Hello World
SUBSTRING(str, start, len)	WyciÄ…ganie fragmentu tekstu	SELECT SUBSTRING('SQL Tutorial', 5, 7); â†’ Tutorial
âœ… Funkcje daty i czasu
Funkcja	Opis	PrzykÅ‚ad
NOW()	Zwraca aktualnÄ… datÄ™ i godzinÄ™	SELECT NOW();
CURDATE()	Zwraca bieÅ¼Ä…cÄ… datÄ™	SELECT CURDATE();
YEAR(date)	Pobiera rok	SELECT YEAR('2024-01-29'); â†’ 2024
DATE_ADD(date, INTERVAL x UNIT)	Dodaje czas	SELECT DATE_ADD('2024-01-01', INTERVAL 7 DAY);
3. Funkcje agregujÄ…ce
DziaÅ‚ajÄ… na wielu wierszach i zwracajÄ… jednÄ… wartoÅ›Ä‡.
NajczÄ™Å›ciej uÅ¼ywane w GROUP BY.

Funkcja	Opis	PrzykÅ‚ad
COUNT(*)	Liczy wiersze	SELECT COUNT(*) FROM klienci;
SUM(kolumna)	Sumuje wartoÅ›ci	SELECT SUM(saldo) FROM konta;
AVG(kolumna)	Åšrednia wartoÅ›Ä‡	SELECT AVG(wiek) FROM pracownicy;
MIN(kolumna)	Najmniejsza wartoÅ›Ä‡	SELECT MIN(pensja) FROM pracownicy;
MAX(kolumna)	NajwiÄ™ksza wartoÅ›Ä‡	SELECT MAX(pensja) FROM pracownicy;
ğŸ”¹ PrzykÅ‚ad uÅ¼ycia z GROUP BY:

sql
Kopiuj
Edytuj
SELECT stanowisko, AVG(pensja)
FROM pracownicy
GROUP BY stanowisko;
âœ… Obliczy Å›redniÄ… pensjÄ™ dla kaÅ¼dego stanowiska.

4. Funkcje uÅ¼ytkownika (UDF - User Defined Functions)
JeÅ›li w SQL brakuje funkcji, ktÃ³rÄ… potrzebujesz, moÅ¼esz stworzyÄ‡ wÅ‚asnÄ… funkcjÄ™!

ğŸ“Œ Jak stworzyÄ‡ funkcjÄ™ w SQL Server?
sql
Kopiuj
Edytuj
CREATE FUNCTION oblicz_podatek (@kwota DECIMAL(10,2))
RETURNS DECIMAL(10,2)
AS
BEGIN
    RETURN @kwota * 0.23;  -- Podatek 23%
END;
ğŸ”¹ Jak uÅ¼ywaÄ‡ funkcji?

sql
Kopiuj
Edytuj
SELECT dbo.oblicz_podatek(1000); -- ZwrÃ³ci 230
âœ… Zalety funkcji uÅ¼ytkownika: âœ” MoÅ¼esz ich uÅ¼ywaÄ‡ jak wbudowanych funkcji
âœ” MogÄ… zwracaÄ‡ jednÄ… wartoÅ›Ä‡ lub tabelÄ™

5. Podsumowanie
ğŸ”¹ Funkcje skalarne â†’ operujÄ… na jednym wierszu, np. UPPER(), ROUND()
ğŸ”¹ Funkcje agregujÄ…ce â†’ dziaÅ‚ajÄ… na wielu wierszach, np. SUM(), AVG()
ğŸ”¹ Funkcje uÅ¼ytkownika (UDF) â†’ tworzone przez programistÃ³w


=================================================================================================PROCEDURY==============================================================================================


1. Co to sÄ… procedury skÅ‚adowane w SQL?
Procedura skÅ‚adowana (Stored Procedure) to zbiÃ³r poleceÅ„ SQL zapisanych w bazie danych, ktÃ³re moÅ¼na wielokrotnie uruchamiaÄ‡.
Jest to jak funkcja, ale rÃ³Å¼ni siÄ™ tym, Å¼e moÅ¼e wykonywaÄ‡ wiele operacji i nie musi zwracaÄ‡ wartoÅ›ci.

2. Jak stworzyÄ‡ procedurÄ™ w SQL?
ğŸ”¹ PrzykÅ‚ad prostej procedury w MySQL:

sql
Kopiuj
Edytuj
DELIMITER $$  
CREATE PROCEDURE WyswietlPracownikow()
BEGIN
    SELECT * FROM pracownicy;
END $$  
DELIMITER ;
ğŸ”¹ Jak wywoÅ‚aÄ‡ procedurÄ™?

sql
Kopiuj
Edytuj
CALL WyswietlPracownikow();
âœ… Procedura wyÅ›wietli wszystkich pracownikÃ³w z tabeli.

3. Procedury z parametrami
Procedury mogÄ… przyjmowaÄ‡ parametry wejÅ›ciowe (IN), wyjÅ›ciowe (OUT) i wejÅ›ciowo-wyjÅ›ciowe (INOUT).

ğŸ”¹ Procedura z parametrem wejÅ›ciowym (IN)

sql
Kopiuj
Edytuj
DELIMITER $$  
CREATE PROCEDURE ZnajdzPracownika(IN pracownik_id INT)
BEGIN
    SELECT * FROM pracownicy WHERE id = pracownik_id;
END $$  
DELIMITER ;
ğŸ”¹ WywoÅ‚anie procedury:

sql
Kopiuj
Edytuj
CALL ZnajdzPracownika(3); -- Znajdzie pracownika o ID = 3
ğŸ”¹ Procedura z parametrem wyjÅ›ciowym (OUT)

sql
Kopiuj
Edytuj
DELIMITER $$  
CREATE PROCEDURE PoliczPracownikow(OUT liczba INT)
BEGIN
    SELECT COUNT(*) INTO liczba FROM pracownicy;
END $$  
DELIMITER ;
ğŸ”¹ WywoÅ‚anie procedury z parametrem OUT:

sql
Kopiuj
Edytuj
CALL PoliczPracownikow(@wynik);
SELECT @wynik; -- ZwrÃ³ci liczbÄ™ pracownikÃ³w
4. Procedury vs Funkcje â€“ NajwaÅ¼niejsze rÃ³Å¼nice
Cecha	Procedura	Funkcja
Zwraca wartoÅ›Ä‡?	âŒ Nie musi	âœ… Tak
Zwraca wiÄ™cej niÅ¼ jednÄ… wartoÅ›Ä‡?	âœ… Tak (moÅ¼e zwracaÄ‡ wiele wynikÃ³w)	âŒ Nie (zwraca tylko jednÄ… wartoÅ›Ä‡)
MoÅ¼e modyfikowaÄ‡ dane? (INSERT, UPDATE, DELETE)	âœ… Tak	âŒ Nie
MoÅ¼e byÄ‡ uÅ¼ywana w SELECT?	âŒ Nie	âœ… Tak
ObsÅ‚uguje parametry IN/OUT/INOUT?	âœ… Tak	âŒ Funkcja ma tylko IN
UÅ¼ycie w JOIN, WHERE	âŒ Nie moÅ¼na uÅ¼ywaÄ‡	âœ… MoÅ¼na uÅ¼ywaÄ‡
ğŸ“Œ GÅ‚Ã³wna rÃ³Å¼nica â†’ Funkcje sÄ… do obliczeÅ„, procedury do wykonywania operacji.

5. Kiedy uÅ¼ywaÄ‡ funkcji, a kiedy procedur?
âœ” Funkcji, gdy potrzebujesz zwrÃ³ciÄ‡ pojedynczÄ… wartoÅ›Ä‡ i uÅ¼ywaÄ‡ jej w SELECT
âœ” Procedury, gdy wykonujesz kilka operacji na bazie (np. modyfikacje, transakcje)

===========================================================================================PODZAPYTANIA=========================================================================

1. Co to sÄ… podzapytania w SQL?
Podzapytanie (subquery) to zapytanie SQL zagnieÅ¼dÅ¼one w innym zapytaniu.
MoÅ¼e zwracaÄ‡ pojedynczÄ… wartoÅ›Ä‡, listÄ™ wartoÅ›ci lub nawet caÅ‚Ä… tabelÄ™.

ğŸ”¹ Struktura podzapytania

sql
Kopiuj
Edytuj
SELECT kolumna FROM tabela WHERE kolumna = (SELECT ... FROM inna_tabela);
ğŸ“Œ Podzapytanie musi byÄ‡ ujÄ™te w nawiasy ().

2. Rodzaje podzapytaÅ„
1ï¸âƒ£ Podzapytania zwracajÄ…ce pojedynczÄ… wartoÅ›Ä‡ (scalar subquery)
2ï¸âƒ£ Podzapytania zwracajÄ…ce wiele wartoÅ›ci (multi-row subquery)
3ï¸âƒ£ Podzapytania zwracajÄ…ce caÅ‚Ä… tabelÄ™ (table subquery)

3. Podzapytania zwracajÄ…ce pojedynczÄ… wartoÅ›Ä‡
âœ… UÅ¼ywane tam, gdzie oczekujemy jednej wartoÅ›ci (np. w WHERE, HAVING).

ğŸ”¹ PrzykÅ‚ad: znajdÅº pracownikÃ³w, ktÃ³rzy zarabiajÄ… wiÄ™cej niÅ¼ Å›rednia pensja w firmie.

sql
Kopiuj
Edytuj
SELECT imie, nazwisko, pensja
FROM pracownicy
WHERE pensja > (SELECT AVG(pensja) FROM pracownicy);
ğŸ“Œ Podzapytanie zwraca pojedynczÄ… wartoÅ›Ä‡ â†’ dziaÅ‚a w WHERE.

4. Podzapytania zwracajÄ…ce wiele wartoÅ›ci
âœ… UÅ¼ywane z operatorami IN, ANY, ALL.

ğŸ”¹ PrzykÅ‚ad: znajdÅº klientÃ³w, ktÃ³rzy zÅ‚oÅ¼yli zamÃ³wienia.

sql
Kopiuj
Edytuj
SELECT imie, nazwisko
FROM klienci
WHERE id IN (SELECT klient_id FROM zamowienia);
ğŸ“Œ Podzapytanie zwraca listÄ™ wartoÅ›ci â†’ uÅ¼ywamy IN.

5. Kwantyfikatory (ANY, ALL, EXISTS)
Kwantyfikatory pozwalajÄ… porÃ³wnywaÄ‡ wartoÅ›ci zwrÃ³cone przez podzapytania.

Operator	Opis
IN	Czy wartoÅ›Ä‡ znajduje siÄ™ w liÅ›cie?
ANY	Czy wartoÅ›Ä‡ pasuje do przynajmniej jednej wartoÅ›ci w podzapytaniu?
ALL	Czy wartoÅ›Ä‡ speÅ‚nia warunek dla wszystkich wynikÃ³w podzapytania?
EXISTS	Czy podzapytanie zwrÃ³ciÅ‚o jakiekolwiek wyniki?
6. ANY â€“ przynajmniej jedna wartoÅ›Ä‡
âœ… Sprawdza, czy wartoÅ›Ä‡ speÅ‚nia warunek dla przynajmniej jednego wiersza w podzapytaniu.
ğŸ”¹ PrzykÅ‚ad: znajdÅº produkty droÅ¼sze niÅ¼ jakikolwiek produkt z kategorii Elektronika.

sql
Kopiuj
Edytuj
SELECT nazwa, cena
FROM produkty
WHERE cena > ANY (SELECT cena FROM produkty WHERE kategoria = 'Elektronika');
ğŸ“Œ JeÅ›li najtaÅ„szy produkt z Elektronika kosztuje 500 zÅ‚, to zapytanie zwrÃ³ci produkty droÅ¼sze niÅ¼ 500 zÅ‚.

7. ALL â€“ wszystkie wartoÅ›ci
âœ… Sprawdza, czy wartoÅ›Ä‡ speÅ‚nia warunek dla wszystkich wierszy w podzapytaniu.
ğŸ”¹ PrzykÅ‚ad: znajdÅº produkty droÅ¼sze niÅ¼ wszystkie produkty z kategorii Elektronika.

sql
Kopiuj
Edytuj
SELECT nazwa, cena
FROM produkty
WHERE cena > ALL (SELECT cena FROM produkty WHERE kategoria = 'Elektronika');
ğŸ“Œ JeÅ›li najdroÅ¼szy produkt w Elektronika kosztuje 1000 zÅ‚, to zapytanie zwrÃ³ci tylko produkty droÅ¼sze niÅ¼ 1000 zÅ‚.

8. EXISTS â€“ czy podzapytanie zwrÃ³ciÅ‚o wyniki?
âœ… Sprawdza, czy podzapytanie zwrÃ³ciÅ‚o jakiekolwiek dane (tak/nie).
ğŸ”¹ PrzykÅ‚ad: znajdÅº klientÃ³w, ktÃ³rzy majÄ… zamÃ³wienia.

sql
Kopiuj
Edytuj
SELECT imie, nazwisko
FROM klienci
WHERE EXISTS (SELECT 1 FROM zamowienia WHERE zamowienia.klient_id = klienci.id);
ğŸ“Œ JeÅ›li dany klient nie ma zamÃ³wienia, to zapytanie go pominie.

9. RÃ³Å¼nice miÄ™dzy IN, ANY, ALL, EXISTS
Operator	Kiedy uÅ¼ywaÄ‡?	Zwracane wartoÅ›ci
IN	JeÅ›li chcemy sprawdziÄ‡, czy wartoÅ›Ä‡ pasuje do listy wartoÅ›ci	Lista wartoÅ›ci
ANY	JeÅ›li chcemy sprawdziÄ‡, czy wartoÅ›Ä‡ pasuje do przynajmniej jednej wartoÅ›ci	Dowolna wartoÅ›Ä‡ speÅ‚niajÄ…ca warunek
ALL	JeÅ›li chcemy sprawdziÄ‡, czy wartoÅ›Ä‡ pasuje do wszystkich wartoÅ›ci	WartoÅ›Ä‡ speÅ‚niajÄ…ca wszystkie warunki
EXISTS	JeÅ›li chcemy sprawdziÄ‡, czy podzapytanie zwrÃ³ciÅ‚o dane	TRUE lub FALSE
10. Podsumowanie
âœ” Podzapytania umoÅ¼liwiajÄ… uÅ¼ywanie wynikÃ³w jednego zapytania w innym zapytaniu.
âœ” IN sprawdza, czy wartoÅ›Ä‡ jest w liÅ›cie wynikÃ³w podzapytania.
âœ” ANY sprawdza, czy wartoÅ›Ä‡ speÅ‚nia warunek dla przynajmniej jednej wartoÅ›ci.
âœ” ALL sprawdza, czy wartoÅ›Ä‡ speÅ‚nia warunek dla wszystkich wynikÃ³w.
âœ” EXISTS zwraca TRUE / FALSE, jeÅ›li podzapytanie ma wyniki.

====================================================================================================================CASE==============================================================

CASE w SQL â€“ Instrukcja Warunkowa
Instrukcja CASE dziaÅ‚a jak if-else w jÄ™zykach programowania i pozwala na zwracanie rÃ³Å¼nych wartoÅ›ci w zaleÅ¼noÅ›ci od warunku.

1. Struktura CASE
SQL obsÅ‚uguje dwie formy CASE:

ğŸ”¹ Prosta (Simple CASE) â€“ porÃ³wnuje wartoÅ›Ä‡ do kilku opcji
ğŸ”¹ PrzeszukujÄ…ca (Searched CASE) â€“ sprawdza wiele warunkÃ³w logicznych

2. Prosta instrukcja CASE
Sprawdza konkretnÄ… wartoÅ›Ä‡ i zwraca okreÅ›lony wynik.

ğŸ”¹ PrzykÅ‚ad: Klasyfikacja pracownikÃ³w na podstawie stanowiska

sql
Kopiuj
Edytuj
SELECT imie, nazwisko, stanowisko,
    CASE stanowisko
        WHEN 'Manager' THEN 'Kierownik'
        WHEN 'Developer' THEN 'Programista'
        WHEN 'Analyst' THEN 'Analityk'
        ELSE 'Inne'
    END AS stanowisko_polskie
FROM pracownicy;
âœ… JeÅ›li stanowisko to 'Manager', wynik to 'Kierownik'.
âœ… JeÅ›li stanowisko nie pasuje do Å¼adnej opcji, zwracamy 'Inne'.

3. PrzeszukujÄ…ca instrukcja CASE
Pozwala na sprawdzanie warunkÃ³w logicznych.

ğŸ”¹ PrzykÅ‚ad: Ocena wysokoÅ›ci pensji

sql
Kopiuj
Edytuj
SELECT imie, nazwisko, pensja,
    CASE 
        WHEN pensja >= 10000 THEN 'Wysoka'
        WHEN pensja BETWEEN 5000 AND 9999 THEN 'Åšrednia'
        ELSE 'Niska'
    END AS kategoria_pensji
FROM pracownicy;
âœ… JeÅ›li pensja >= 10000, wynik to 'Wysoka'.
âœ… JeÅ›li pensja miÄ™dzy 5000-9999, wynik to 'Åšrednia'.
âœ… W przeciwnym razie wynik to 'Niska'.

4. CASE w ORDER BY â€“ Sortowanie warunkowe
MoÅ¼emy uÅ¼yÄ‡ CASE w ORDER BY, aby sortowaÄ‡ dynamicznie.

ğŸ”¹ PrzykÅ‚ad: Sortowanie pracownikÃ³w wedÅ‚ug kategorii pensji

sql
Kopiuj
Edytuj
SELECT imie, nazwisko, pensja
FROM pracownicy
ORDER BY 
    CASE 
        WHEN pensja >= 10000 THEN 1
        WHEN pensja BETWEEN 5000 AND 9999 THEN 2
        ELSE 3
    END;
ğŸ“Œ Najpierw bÄ™dÄ… wysokie pensje (1), potem Å›rednie (2), na koÅ„cu niskie (3).

5. CASE w GROUP BY â€“ Grupowanie dynamiczne
MoÅ¼emy tworzyÄ‡ dynamiczne grupowanie wartoÅ›ci.

ğŸ”¹ PrzykÅ‚ad: Liczenie pracownikÃ³w wedÅ‚ug kategorii pensji

sql
Kopiuj
Edytuj
SELECT 
    CASE 
        WHEN pensja >= 10000 THEN 'Wysoka pensja'
        WHEN pensja BETWEEN 5000 AND 9999 THEN 'Åšrednia pensja'
        ELSE 'Niska pensja'
    END AS kategoria_pensji,
    COUNT(*) AS liczba_pracownikow
FROM pracownicy
GROUP BY 
    CASE 
        WHEN pensja >= 10000 THEN 'Wysoka pensja'
        WHEN pensja BETWEEN 5000 AND 9999 THEN 'Åšrednia pensja'
        ELSE 'Niska pensja'
    END;
âœ… Pokazuje ile pracownikÃ³w mieÅ›ci siÄ™ w kaÅ¼dej kategorii.

6. CASE w HAVING â€“ Filtrowanie grup
MoÅ¼emy filtrowaÄ‡ wyniki grupowania.

ğŸ”¹ PrzykÅ‚ad: PokaÅ¼ tylko grupy, ktÃ³re majÄ… wiÄ™cej niÅ¼ 5 pracownikÃ³w

sql
Kopiuj
Edytuj
SELECT 
    CASE 
        WHEN pensja >= 10000 THEN 'Wysoka pensja'
        WHEN pensja BETWEEN 5000 AND 9999 THEN 'Åšrednia pensja'
        ELSE 'Niska pensja'
    END AS kategoria_pensji,
    COUNT(*) AS liczba_pracownikow
FROM pracownicy
GROUP BY 
    CASE 
        WHEN pensja >= 10000 THEN 'Wysoka pensja'
        WHEN pensja BETWEEN 5000 AND 9999 THEN 'Åšrednia pensja'
        ELSE 'Niska pensja'
    END
HAVING COUNT(*) > 5;
âœ… Pokazuje tylko grupy, w ktÃ³rych jest wiÄ™cej niÅ¼ 5 pracownikÃ³w.

7. CASE w UPDATE â€“ Aktualizacja warunkowa
MoÅ¼emy uÅ¼yÄ‡ CASE do aktualizacji danych.

ğŸ”¹ PrzykÅ‚ad: Przypisanie premii w zaleÅ¼noÅ›ci od pensji

sql
Kopiuj
Edytuj
UPDATE pracownicy
SET premia = 
    CASE 
        WHEN pensja >= 10000 THEN 2000
        WHEN pensja BETWEEN 5000 AND 9999 THEN 1000
        ELSE 500
    END;
âœ… Pracownicy z wysokÄ… pensjÄ… dostanÄ… wyÅ¼szÄ… premiÄ™.

8. Podsumowanie
Zastosowanie CASE	PrzykÅ‚ad
Zmiana wartoÅ›ci w SELECT	TÅ‚umaczenie stanowisk
Kategoryzacja danych	PodziaÅ‚ pensji na "Wysoka/Åšrednia/Niska"
Dynamiczne sortowanie (ORDER BY)	Sortowanie po kategorii pensji
Dynamiczne grupowanie (GROUP BY)	Liczenie pracownikÃ³w wedÅ‚ug kategorii
Filtrowanie grup (HAVING)	Pokazanie tylko duÅ¼ych grup
Warunkowa aktualizacja (UPDATE)	Nadanie premii zaleÅ¼nie od pensji
ğŸ”¹ GÅ‚Ã³wna zaleta CASE?
ğŸ‘‰ Eliminuje koniecznoÅ›Ä‡ wielu IF i UNION w zapytaniach!

==================================================================================================TRIGGERY================================================================================

Trigery w SQL â€“ Co to jest i jak dziaÅ‚a?
Trigger to specjalny mechanizm w bazie danych, ktÃ³ry automatycznie wykonuje kod SQL w odpowiedzi na okreÅ›lone zdarzenie (np. INSERT, UPDATE, DELETE).

Trigery dziaÅ‚ajÄ… automatycznie, wiÄ™c nie musisz ich wywoÅ‚ywaÄ‡ rÄ™cznie.

1. Rodzaje triggerÃ³w
Trigery moÅ¼na podzieliÄ‡ na kilka kategorii:

ğŸ“Œ Ze wzglÄ™du na moment uruchomienia
Rodzaj triggera	Opis
BEFORE	Wykonuje kod przed operacjÄ… (INSERT, UPDATE, DELETE)
AFTER	Wykonuje kod po operacji (INSERT, UPDATE, DELETE)
ğŸ“Œ Ze wzglÄ™du na typ operacji
Rodzaj triggera	Opis
INSERT	DziaÅ‚a, gdy wstawiany jest nowy rekord
UPDATE	DziaÅ‚a, gdy aktualizowany jest rekord
DELETE	DziaÅ‚a, gdy usuwany jest rekord
âœ… MoÅ¼esz uÅ¼yÄ‡ np. BEFORE INSERT, AFTER DELETE itp.

2. SkÅ‚adnia triggera
ğŸ”¹ Podstawowa struktura
sql
Kopiuj
Edytuj
CREATE TRIGGER nazwa_triggera
BEFORE | AFTER INSERT | UPDATE | DELETE
ON nazwa_tabeli
FOR EACH ROW
BEGIN
    -- Kod SQL, ktÃ³ry zostanie wykonany
END;
ğŸ“Œ FOR EACH ROW â€“ oznacza, Å¼e trigger dziaÅ‚a dla kaÅ¼dego wiersza osobno.

3. PrzykÅ‚ady triggerÃ³w
ğŸ“Œ BEFORE INSERT â€“ Walidacja danych przed wstawieniem
ğŸ”¹ PrzykÅ‚ad: Nie pozwÃ³l dodaÄ‡ pracownika z pensjÄ… poniÅ¼ej 3000 zÅ‚.

sql
Kopiuj
Edytuj
DELIMITER $$  
CREATE TRIGGER sprawdz_pensje
BEFORE INSERT ON pracownicy
FOR EACH ROW
BEGIN
    IF NEW.pensja < 3000 THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Pensja musi byÄ‡ co najmniej 3000 zÅ‚';
    END IF;
END $$  
DELIMITER ;
âœ… NEW.pensja oznacza wartoÅ›Ä‡ nowego wiersza.

ğŸ“Œ AFTER INSERT â€“ Automatyczne logowanie operacji
ğŸ”¹ PrzykÅ‚ad: Po dodaniu zamÃ³wienia, zapisz informacjÄ™ do tabeli log_zamowienia.

sql
Kopiuj
Edytuj
DELIMITER $$  
CREATE TRIGGER loguj_zamowienie
AFTER INSERT ON zamowienia
FOR EACH ROW
BEGIN
    INSERT INTO log_zamowienia (zamowienie_id, data)
    VALUES (NEW.id, NOW());
END $$  
DELIMITER ;
âœ… Tworzy wpis w tabeli logÃ³w po dodaniu zamÃ³wienia.

ğŸ“Œ BEFORE UPDATE â€“ Zmiana wartoÅ›ci przed aktualizacjÄ…
ğŸ”¹ PrzykÅ‚ad: JeÅ›li ktoÅ› chce ustawiÄ‡ pensjÄ™ mniejszÄ… niÅ¼ 3000 zÅ‚, automatycznie ustaw na 3000.

sql
Kopiuj
Edytuj
DELIMITER $$  
CREATE TRIGGER minimalna_pensja
BEFORE UPDATE ON pracownicy
FOR EACH ROW
BEGIN
    IF NEW.pensja < 3000 THEN
        SET NEW.pensja = 3000;
    END IF;
END $$  
DELIMITER ;
âœ… NEW.pensja zmienia wartoÅ›Ä‡ przed zapisaniem do bazy.

ğŸ“Œ AFTER DELETE â€“ Logowanie usuniÄ™tych rekordÃ³w
ğŸ”¹ PrzykÅ‚ad: Po usuniÄ™ciu pracownika zapisuje jego dane do tabeli pracownicy_usunieci.

sql
Kopiuj
Edytuj
DELIMITER $$  
CREATE TRIGGER archiwizuj_pracownika
AFTER DELETE ON pracownicy
FOR EACH ROW
BEGIN
    INSERT INTO pracownicy_usunieci (id, imie, nazwisko, data_usuniecia)
    VALUES (OLD.id, OLD.imie, OLD.nazwisko, NOW());
END $$  
DELIMITER ;
âœ… OLD. odnosi siÄ™ do danych usuwanego rekordu.

4. NEW. vs OLD. â€“ Jak odwoÅ‚ywaÄ‡ siÄ™ do danych?
Sytuacja	**NEW. (Nowa wartoÅ›Ä‡)	OLD. (Stara wartoÅ›Ä‡)
INSERT	âœ… DostÄ™pne	âŒ NiedostÄ™pne
UPDATE	âœ… DostÄ™pne	âœ… DostÄ™pne
DELETE	âŒ NiedostÄ™pne	âœ… DostÄ™pne
ğŸ“Œ NEW. â†’ wartoÅ›ci po operacji
ğŸ“Œ OLD. â†’ wartoÅ›ci przed operacjÄ…

5. Jak usunÄ…Ä‡ trigger?
Aby usunÄ…Ä‡ trigger, uÅ¼ywamy DROP TRIGGER.

ğŸ”¹ PrzykÅ‚ad:

sql
Kopiuj
Edytuj
DROP TRIGGER IF EXISTS sprawdz_pensje;
6. Czy triggery mogÄ… zmieniaÄ‡ dane?
âœ… Tak, ale nie mogÄ… wywoÅ‚aÄ‡ tej samej operacji!
Np. BEFORE UPDATE nie moÅ¼e wykonywaÄ‡ UPDATE na tej samej tabeli, bo powstanie zapÄ™tlenie.

7. Kiedy warto uÅ¼ywaÄ‡ triggerÃ³w?
âœ” Automatyczne logowanie zmian
âœ” Walidacja danych przed zapisaniem
âœ” Automatyczne modyfikowanie rekordÃ³w

âŒ Kiedy NIE uÅ¼ywaÄ‡ triggerÃ³w?
ğŸš« JeÅ›li Å‚atwiej zrobiÄ‡ to w kodzie aplikacji â€“ triggery mogÄ… obciÄ…Å¼aÄ‡ bazÄ™.

8. Podsumowanie
Typ Triggera	Zastosowanie
BEFORE INSERT	Walidacja danych przed dodaniem
AFTER INSERT	Automatyczne logowanie zmian
BEFORE UPDATE	Zmiana wartoÅ›ci przed aktualizacjÄ…
AFTER DELETE	Archiwizacja usuniÄ™tych rekordÃ³w
ğŸ”¹ GÅ‚Ã³wna zaleta triggerÃ³w?
ğŸ‘‰ AutomatyzujÄ… operacje i zwiÄ™kszajÄ… spÃ³jnoÅ›Ä‡ danych!



================================================================================================NORMALIZACJA==================================================================

Normalizacja w bazach danych â€“ Proste wyjaÅ›nienie
Czym jest normalizacja?

Normalizacja to proces, ktÃ³ry pozwala na uporzÄ…dkowanie danych w bazach danych w taki sposÃ³b, Å¼eby byÅ‚y one przechowywane w jak najprostszej formie, bez powtarzajÄ…cych siÄ™ informacji i problemÃ³w zwiÄ…zanych z aktualizacjÄ… czy usuwaniem danych. Celem normalizacji jest eliminowanie tzw. anomalii, takich jak:

Anomalie aktualizacji â€“ trudnoÅ›Ä‡ w modyfikowaniu danych w jednym miejscu, co moÅ¼e prowadziÄ‡ do niespÃ³jnoÅ›ci.
Anomalie wstawiania â€“ niemoÅ¼noÅ›Ä‡ dodania danych bez bÅ‚Ä™dÃ³w.
Anomalie usuwania â€“ przypadkowe usuniÄ™cie waÅ¼nych danych.
Formy normalne â€“ krok po kroku
Normalizacja bazuje na tzw. formach normalnych. KaÅ¼da forma to pewna zasada, ktÃ³ra eliminuje rÃ³Å¼ne rodzaje problemÃ³w w bazie danych. Zacznijmy od pierwszej formy i idÅºmy do bardziej zaawansowanych.

1. Pierwsza Forma Normalna (1NF)
ZaÅ‚oÅ¼enia:

Wszystkie kolumny w tabeli muszÄ… zawieraÄ‡ jednÄ… wartoÅ›Ä‡. Nie mogÄ… to byÄ‡ listy czy zbiory.
Wszystkie wiersze muszÄ… byÄ‡ unikalne.

2. Druga Forma Normalna (2NF)
ZaÅ‚oÅ¼enia:

Tabela musi byÄ‡ w 1NF.
KaÅ¼dy atrybut w tabeli musi zaleÅ¼eÄ‡ w peÅ‚ni od klucza gÅ‚Ã³wnego. JeÅ›li w tabeli jest klucz zÅ‚oÅ¼ony (np. wiÄ™cej niÅ¼ jedna kolumna identyfikuje rekord), to nie moÅ¼e byÄ‡ tak, Å¼e jedna kolumna zaleÅ¼y tylko od czÄ™Å›ci tego klucza.

3. Trzecia Forma Normalna (3NF)
ZaÅ‚oÅ¼enia:

Tabela musi byÄ‡ w 2NF.
Å»adne dane nie mogÄ… zaleÅ¼eÄ‡ od innych atrybutÃ³w w tabeli (tzw. zaleÅ¼noÅ›ci przejÅ›ciowe). KaÅ¼dy atrybut musi zaleÅ¼eÄ‡ tylko od klucza gÅ‚Ã³wnego.

4. CzwÃ³rta Forma Normalna (4NF)
ZaÅ‚oÅ¼enia:

Tabela musi byÄ‡ w 3NF.
Nie moÅ¼e wystÄ™powaÄ‡ tzw. wielowartoÅ›ciowa zaleÅ¼noÅ›Ä‡. Oznacza to, Å¼e jedna kolumna nie moÅ¼e zaleÅ¼eÄ‡ od dwÃ³ch innych kolumn jednoczeÅ›nie, co prowadziÅ‚oby do powtÃ³rzeÅ„ w tabeli.

5. PiÄ…ta Forma Normalna (5NF)
ZaÅ‚oÅ¼enia:

Tabela musi byÄ‡ w 4NF.
Tabela nie moÅ¼e zawieraÄ‡ danych, ktÃ³re moÅ¼na by rozbiÄ‡ na mniejsze czÄ™Å›ci bez utraty informacji. Chodzi o rozdzielenie danych, ktÃ³re sÄ… ze sobÄ… powiÄ…zane, w taki sposÃ³b, Å¼eby nie byÅ‚o koniecznoÅ›ci Å‚Ä…czenia tabel w sposÃ³b, ktÃ³ry prowadziÅ‚by do utraty informacji.


Podsumowanie
Normalizacja to sposÃ³b organizowania danych w bazach danych. DziÄ™ki niej dane sÄ… przechowywane w sposÃ³b uporzÄ…dkowany, co uÅ‚atwia ich aktualizowanie i zapewnia, Å¼e nie wystÄ™pujÄ… niepotrzebne powtÃ³rzenia. Normalizujemy dane, aby zmniejszyÄ‡ problemy z aktualizowaniem, wstawianiem czy usuwaniem danych. Zaczynamy od 1NF i przechodzimy przez kolejne formy, aÅ¼ dane sÄ… idealnie zorganizowane, a baza jest bardziej wydajna i mniej podatna na bÅ‚Ä™dy.

