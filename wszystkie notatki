
===============================================================================================================TRANSAKCJE=============================================================================================


1. Co to jest transakcja w bazie danych?
Transakcja to zbiÃ³r operacji na bazie danych, ktÃ³re sÄ… wykonywane jako jedna, niepodzielna jednostka pracy.
Oznacza to, Å¼e albo wszystkie operacje w transakcji zostanÄ… wykonane (zatwierdzone), albo Å¼adna z nich (cofniÄ™cie zmian).

ğŸ”¹ PrzykÅ‚ad transakcji:
WyobraÅº sobie, Å¼e chcesz przelaÄ‡ pieniÄ…dze z konta A na konto B.
Wymaga to dwÃ³ch operacji:

OdjÄ™cie kwoty z konta A
Dodanie tej samej kwoty do konta B
Co siÄ™ stanie, jeÅ›li odejmiemy pieniÄ…dze z konta A, ale przed dodaniem ich do konta B nastÄ…pi awaria systemu?
Bez transakcji moglibyÅ›my utraciÄ‡ pieniÄ…dze, bo tylko pierwsza operacja zostaÅ‚aby wykonana.

WÅ‚aÅ›nie dlatego transakcja gwarantuje, Å¼e albo obie operacje siÄ™ wykonajÄ…, albo Å¼adna z nich!

2. Zasady transakcji â€“ ACID
KaÅ¼da transakcja powinna speÅ‚niaÄ‡ cztery podstawowe zasady ACID:

Zasada	Opis
A (Atomicity, NiepodzielnoÅ›Ä‡)	Transakcja jest niepodzielna â€“ albo wykonuje siÄ™ w caÅ‚oÅ›ci, albo nie wykonuje siÄ™ wcale.
C (Consistency, SpÃ³jnoÅ›Ä‡)	Po zakoÅ„czeniu transakcji baza danych musi pozostaÄ‡ w spÃ³jnym stanie (np. saldo konta siÄ™ zgadza).
I (Isolation, Izolacja)	RÃ³wnoczeÅ›nie dziaÅ‚ajÄ…ce transakcje nie powinny sobie przeszkadzaÄ‡.
D (Durability, TrwaÅ‚oÅ›Ä‡)	Po zatwierdzeniu (COMMIT) zmiany nie mogÄ… zostaÄ‡ utracone.
âœ… DziÄ™ki tym zasadom baza danych dziaÅ‚a poprawnie i bez bÅ‚Ä™dÃ³w!

3. Jak dziaÅ‚ajÄ… transakcje w SQL?
W SQL transakcje obsÅ‚ugujemy za pomocÄ… trzech podstawowych poleceÅ„:

1ï¸âƒ£ RozpoczÄ™cie transakcji

sql
Kopiuj
Edytuj
START TRANSACTION; -- Rozpoczynamy transakcjÄ™
2ï¸âƒ£ Wykonanie operacji

sql
Kopiuj
Edytuj
UPDATE konto SET saldo = saldo - 100 WHERE id = 1;  -- Odejmujemy 100 zÅ‚ z konta 1
UPDATE konto SET saldo = saldo + 100 WHERE id = 2;  -- Dodajemy 100 zÅ‚ do konta 2
3ï¸âƒ£ Zatwierdzenie zmian (COMMIT) lub ich anulowanie (ROLLBACK)

sql
Kopiuj
Edytuj
COMMIT;   -- Potwierdzamy transakcjÄ™, zapisujÄ…c zmiany
-- LUB
ROLLBACK; -- Cofamy transakcjÄ™, usuwajÄ…c wszystkie zmiany
ğŸŸ¢ JeÅ›li wszystko dziaÅ‚a dobrze â†’ COMMIT zapisuje zmiany w bazie.
ğŸ”´ JeÅ›li coÅ› poszÅ‚o nie tak â†’ ROLLBACK przywraca bazÄ™ do poprzedniego stanu.

4. Problemy przy rÃ³wnoczesnych transakcjach
Gdy wiele transakcji dziaÅ‚a w tym samym czasie, mogÄ… pojawiÄ‡ siÄ™ problemy, np.:

Problem	Opis
Dirty Read (brudny odczyt)	Transakcja A czyta dane, ktÃ³re transakcja B zmieniÅ‚a, ale nie zatwierdziÅ‚a (COMMIT). JeÅ›li transakcja B zrobi ROLLBACK, transakcja A bazuje na bÅ‚Ä™dnych danych.
Non-Repeatable Read (niepowtarzalny odczyt)	Transakcja A odczytuje te same dane dwa razy, ale transakcja B je zmienia miÄ™dzy odczytami.
Phantom Read (widmowy odczyt)	Transakcja A wykonuje zapytanie np. SELECT * FROM klienci WHERE wiek > 18, a transakcja B dodaje nowy rekord pasujÄ…cy do warunku â€“ A dostaje inny wynik niÅ¼ poprzednio.
5. Poziomy izolacji w SQL (jak transakcje wpÅ‚ywajÄ… na siebie nawzajem)
Poziomy izolacji okreÅ›lajÄ…, jak bardzo transakcje mogÄ… na siebie wpÅ‚ywaÄ‡.
Im wyÅ¼szy poziom izolacji, tym mniejsze ryzyko bÅ‚Ä™dÃ³w, ale wiÄ™kszy spadek wydajnoÅ›ci.

Poziom izolacji	Chroni przed:
READ UNCOMMITTED	âŒ Brak ochrony, moÅ¼e wystÄ…piÄ‡ Dirty Read
READ COMMITTED	âœ… Blokuje Dirty Read, ale moÅ¼e wystÄ…piÄ‡ Non-Repeatable Read
REPEATABLE READ	âœ… Blokuje Dirty Read i Non-Repeatable Read, ale moÅ¼e wystÄ…piÄ‡ Phantom Read
SERIALIZABLE	âœ… Blokuje wszystkie bÅ‚Ä™dy, ale jest najwolniejszy
6. PrzykÅ‚ady poziomÃ³w izolacji w SQL
KaÅ¼dy poziom izolacji moÅ¼emy ustawiÄ‡ w transakcji:

ğŸ”¹ READ COMMITTED (domyÅ›lny poziom w SQL Server i Oracle)

sql
Kopiuj
Edytuj
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
START TRANSACTION;
SELECT * FROM klienci;
COMMIT;
âœ… Blokuje brudne odczyty (Dirty Read).

ğŸ”¹ SERIALIZABLE (najbezpieczniejszy, ale najwolniejszy)

sql
Kopiuj
Edytuj
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
START TRANSACTION;
SELECT * FROM zamowienia WHERE status = 'oczekujÄ…ce';
COMMIT;
âœ… Gwarantuje maksymalnÄ… izolacjÄ™, ale moÅ¼e powodowaÄ‡ blokady.

7. Podsumowanie â€“ co warto zapamiÄ™taÄ‡?
âœ” Transakcja to seria operacji, ktÃ³re wykonujÄ… siÄ™ razem.
âœ” ACID zapewnia bezpieczeÅ„stwo i spÃ³jnoÅ›Ä‡ transakcji.
âœ” Poziomy izolacji okreÅ›lajÄ…, jak transakcje wpÅ‚ywajÄ… na siebie nawzajem.
âœ” Im wyÅ¼szy poziom izolacji, tym mniejsze ryzyko bÅ‚Ä™dÃ³w, ale wiÄ™kszy spadek wydajnoÅ›ci.

==================================================================================================FUNKCJE=======================================================================


OczywiÅ›cie! OmÃ³wiÄ™ funkcje w bazach danych, w szczegÃ³lnoÅ›ci w SQL, poniewaÅ¼ sÄ… one kluczowym elementem pracy z danymi.

1. Co to jest funkcja w SQL?
Funkcja to blok kodu, ktÃ³ry przyjmuje argumenty, wykonuje okreÅ›lone operacje i zwraca wynik.
DziÄ™ki funkcjom moÅ¼na manipulowaÄ‡ danymi, wykonywaÄ‡ obliczenia i automatyzowaÄ‡ operacje w bazie danych.

Rodzaje funkcji w SQL:
1ï¸âƒ£ Funkcje skalarne â€“ zwracajÄ… pojedynczÄ… wartoÅ›Ä‡
2ï¸âƒ£ Funkcje agregujÄ…ce â€“ operujÄ… na wielu wierszach i zwracajÄ… jednÄ… wartoÅ›Ä‡
3ï¸âƒ£ Funkcje uÅ¼ytkownika (UDF) â€“ tworzone przez programistÄ™

2. Funkcje skalarne (jednowierszowe)
ZwracajÄ… jednÄ… wartoÅ›Ä‡ na podstawie pojedynczego wiersza danych.

ğŸ“Œ PrzykÅ‚ady funkcji skalarnych:
âœ… Funkcje matematyczne
Funkcja	Opis	PrzykÅ‚ad
ABS(x)	WartoÅ›Ä‡ bezwzglÄ™dna	SELECT ABS(-5); â†’ 5
ROUND(x, d)	ZaokrÄ…glanie do d miejsc po przecinku	SELECT ROUND(3.1415, 2); â†’ 3.14
CEIL(x)	ZaokrÄ…glenie w gÃ³rÄ™	SELECT CEIL(2.3); â†’ 3
FLOOR(x)	ZaokrÄ…glenie w dÃ³Å‚	SELECT FLOOR(2.9); â†’ 2
âœ… Funkcje tekstowe
Funkcja	Opis	PrzykÅ‚ad
UPPER(str)	Zamienia na wielkie litery	SELECT UPPER('test'); â†’ TEST
LOWER(str)	Zamienia na maÅ‚e litery	SELECT LOWER('TeSt'); â†’ test
LENGTH(str)	DÅ‚ugoÅ›Ä‡ ciÄ…gu znakÃ³w	SELECT LENGTH('SQL'); â†’ 3
CONCAT(str1, str2)	ÅÄ…czenie tekstÃ³w	SELECT CONCAT('Hello', ' World'); â†’ Hello World
SUBSTRING(str, start, len)	WyciÄ…ganie fragmentu tekstu	SELECT SUBSTRING('SQL Tutorial', 5, 7); â†’ Tutorial
âœ… Funkcje daty i czasu
Funkcja	Opis	PrzykÅ‚ad
NOW()	Zwraca aktualnÄ… datÄ™ i godzinÄ™	SELECT NOW();
CURDATE()	Zwraca bieÅ¼Ä…cÄ… datÄ™	SELECT CURDATE();
YEAR(date)	Pobiera rok	SELECT YEAR('2024-01-29'); â†’ 2024
DATE_ADD(date, INTERVAL x UNIT)	Dodaje czas	SELECT DATE_ADD('2024-01-01', INTERVAL 7 DAY);
3. Funkcje agregujÄ…ce
DziaÅ‚ajÄ… na wielu wierszach i zwracajÄ… jednÄ… wartoÅ›Ä‡.
NajczÄ™Å›ciej uÅ¼ywane w GROUP BY.

Funkcja	Opis	PrzykÅ‚ad
COUNT(*)	Liczy wiersze	SELECT COUNT(*) FROM klienci;
SUM(kolumna)	Sumuje wartoÅ›ci	SELECT SUM(saldo) FROM konta;
AVG(kolumna)	Åšrednia wartoÅ›Ä‡	SELECT AVG(wiek) FROM pracownicy;
MIN(kolumna)	Najmniejsza wartoÅ›Ä‡	SELECT MIN(pensja) FROM pracownicy;
MAX(kolumna)	NajwiÄ™ksza wartoÅ›Ä‡	SELECT MAX(pensja) FROM pracownicy;
ğŸ”¹ PrzykÅ‚ad uÅ¼ycia z GROUP BY:

sql
Kopiuj
Edytuj
SELECT stanowisko, AVG(pensja)
FROM pracownicy
GROUP BY stanowisko;
âœ… Obliczy Å›redniÄ… pensjÄ™ dla kaÅ¼dego stanowiska.

4. Funkcje uÅ¼ytkownika (UDF - User Defined Functions)
JeÅ›li w SQL brakuje funkcji, ktÃ³rÄ… potrzebujesz, moÅ¼esz stworzyÄ‡ wÅ‚asnÄ… funkcjÄ™!

ğŸ“Œ Jak stworzyÄ‡ funkcjÄ™ w SQL Server?
sql
Kopiuj
Edytuj
CREATE FUNCTION oblicz_podatek (@kwota DECIMAL(10,2))
RETURNS DECIMAL(10,2)
AS
BEGIN
    RETURN @kwota * 0.23;  -- Podatek 23%
END;
ğŸ”¹ Jak uÅ¼ywaÄ‡ funkcji?

sql
Kopiuj
Edytuj
SELECT dbo.oblicz_podatek(1000); -- ZwrÃ³ci 230
âœ… Zalety funkcji uÅ¼ytkownika: âœ” MoÅ¼esz ich uÅ¼ywaÄ‡ jak wbudowanych funkcji
âœ” MogÄ… zwracaÄ‡ jednÄ… wartoÅ›Ä‡ lub tabelÄ™

5. Podsumowanie
ğŸ”¹ Funkcje skalarne â†’ operujÄ… na jednym wierszu, np. UPPER(), ROUND()
ğŸ”¹ Funkcje agregujÄ…ce â†’ dziaÅ‚ajÄ… na wielu wierszach, np. SUM(), AVG()
ğŸ”¹ Funkcje uÅ¼ytkownika (UDF) â†’ tworzone przez programistÃ³w


=================================================================================================PROCEDURY==============================================================================================


1. Co to sÄ… procedury skÅ‚adowane w SQL?
Procedura skÅ‚adowana (Stored Procedure) to zbiÃ³r poleceÅ„ SQL zapisanych w bazie danych, ktÃ³re moÅ¼na wielokrotnie uruchamiaÄ‡.
Jest to jak funkcja, ale rÃ³Å¼ni siÄ™ tym, Å¼e moÅ¼e wykonywaÄ‡ wiele operacji i nie musi zwracaÄ‡ wartoÅ›ci.

2. Jak stworzyÄ‡ procedurÄ™ w SQL?
ğŸ”¹ PrzykÅ‚ad prostej procedury w MySQL:

sql
Kopiuj
Edytuj
DELIMITER $$  
CREATE PROCEDURE WyswietlPracownikow()
BEGIN
    SELECT * FROM pracownicy;
END $$  
DELIMITER ;
ğŸ”¹ Jak wywoÅ‚aÄ‡ procedurÄ™?

sql
Kopiuj
Edytuj
CALL WyswietlPracownikow();
âœ… Procedura wyÅ›wietli wszystkich pracownikÃ³w z tabeli.

3. Procedury z parametrami
Procedury mogÄ… przyjmowaÄ‡ parametry wejÅ›ciowe (IN), wyjÅ›ciowe (OUT) i wejÅ›ciowo-wyjÅ›ciowe (INOUT).

ğŸ”¹ Procedura z parametrem wejÅ›ciowym (IN)

sql
Kopiuj
Edytuj
DELIMITER $$  
CREATE PROCEDURE ZnajdzPracownika(IN pracownik_id INT)
BEGIN
    SELECT * FROM pracownicy WHERE id = pracownik_id;
END $$  
DELIMITER ;
ğŸ”¹ WywoÅ‚anie procedury:

sql
Kopiuj
Edytuj
CALL ZnajdzPracownika(3); -- Znajdzie pracownika o ID = 3
ğŸ”¹ Procedura z parametrem wyjÅ›ciowym (OUT)

sql
Kopiuj
Edytuj
DELIMITER $$  
CREATE PROCEDURE PoliczPracownikow(OUT liczba INT)
BEGIN
    SELECT COUNT(*) INTO liczba FROM pracownicy;
END $$  
DELIMITER ;
ğŸ”¹ WywoÅ‚anie procedury z parametrem OUT:

sql
Kopiuj
Edytuj
CALL PoliczPracownikow(@wynik);
SELECT @wynik; -- ZwrÃ³ci liczbÄ™ pracownikÃ³w
4. Procedury vs Funkcje â€“ NajwaÅ¼niejsze rÃ³Å¼nice
Cecha	Procedura	Funkcja
Zwraca wartoÅ›Ä‡?	âŒ Nie musi	âœ… Tak
Zwraca wiÄ™cej niÅ¼ jednÄ… wartoÅ›Ä‡?	âœ… Tak (moÅ¼e zwracaÄ‡ wiele wynikÃ³w)	âŒ Nie (zwraca tylko jednÄ… wartoÅ›Ä‡)
MoÅ¼e modyfikowaÄ‡ dane? (INSERT, UPDATE, DELETE)	âœ… Tak	âŒ Nie
MoÅ¼e byÄ‡ uÅ¼ywana w SELECT?	âŒ Nie	âœ… Tak
ObsÅ‚uguje parametry IN/OUT/INOUT?	âœ… Tak	âŒ Funkcja ma tylko IN
UÅ¼ycie w JOIN, WHERE	âŒ Nie moÅ¼na uÅ¼ywaÄ‡	âœ… MoÅ¼na uÅ¼ywaÄ‡
ğŸ“Œ GÅ‚Ã³wna rÃ³Å¼nica â†’ Funkcje sÄ… do obliczeÅ„, procedury do wykonywania operacji.

5. Kiedy uÅ¼ywaÄ‡ funkcji, a kiedy procedur?
âœ” Funkcji, gdy potrzebujesz zwrÃ³ciÄ‡ pojedynczÄ… wartoÅ›Ä‡ i uÅ¼ywaÄ‡ jej w SELECT
âœ” Procedury, gdy wykonujesz kilka operacji na bazie (np. modyfikacje, transakcje)
